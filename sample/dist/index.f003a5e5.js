var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},e={},i={},s=t.parcelRequire024f;null==s&&((s=function(t){if(t in e)return e[t].exports;if(t in i){var s=i[t];delete i[t];var n={id:t,exports:{}};return e[t]=n,s.call(n.exports,n,n.exports),n.exports}var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(t,e){i[t]=e},t.parcelRequire024f=s),s.register("c565k",(function(t,e){var i,s,n,o,h;i=t.exports,Object.defineProperty(i,"__esModule",{value:!0,configurable:!0}),s=t.exports,n="default",o=()=>l,Object.defineProperty(s,n,{get:o,set:h,enumerable:!0,configurable:!0});const a=(t,e)=>{if(0===e)return t>=0?0:Math.PI;const i=Math.atan2(e,t);return i>0?i:2*Math.PI+i},r=t=>t*(Math.PI/180);class c{constructor(t,e,i,s,{items:n,radius:o,origin:h,rotation:a,onClick:c,onMoved:l,selected:d,isBidirectional:u=!1,isReverse:f=!1,selectedRotation:E}){if(this.scene=e,this.camera=i,this.canvas=s,"undefined"!=typeof THREE?this.THREE=THREE:this.THREE=t,this.radius=o,this.wheel=new this.THREE.Object3D,this.onClick=c,this.onMoved=l,this.items=n,this.itemParams={},this.itemList=[],this.nextItem=null,this.currentItem=null,this.selected=d||n[0],this.isRotating=!1,this.isBidirectional=u,this.isReverse=f,this.rotationDirection=1,this.selectedVector=Math.abs(a.x)>Math.abs(a.y)?new this.THREE.Vector2(0,Math.sign(a.x)||-1):new this.THREE.Vector2(-Math.sign(a.y)||-1,0),this.X_VECTOR=new this.THREE.Vector2(1,0),this.ITEM_RATIO=4,E){const t=r(E),e=this.radius*Math.cos(t),i=this.radius*Math.sin(t);this.selectedVector=new this.THREE.Vector2(e,i),this.selectedVector.normalize()}const g=n.length,T=360/g;this.wheel.rotation.x=a.x,this.wheel.rotation.y=a.y,this.wheel.rotation.z=a.z,this.wheel.position.x=h.x,this.wheel.position.y=h.y,this.wheel.position.z=h.z;let m=0;for(let t=0;t<g;t++){const e=n[t]instanceof HTMLElement&&"canvas"===n[t]?.tagName?.toLowerCase(),i=r(t*T),s=new this.THREE.Vector2(o*Math.cos(i),o*Math.sin(i)),h=e?this.getCanvasSplite(n[t]):this.getTextSplite({text:n[t].name,width:n[t].width||300,height:n[t].height,color:n[t].color||"#000000",fillStyle:n[t].fillStyle||"#ffffff",font:n[t].font||"Bold sans-serif",fontSize:n[t].size||20,padding:n[t].padding||10});h.position.x=s.x,h.position.y=s.y,(this.selected&&e&&this.selected.isEqualNode&&this.selected.isEqualNode(n[t])||this.selected&&!e&&this.selected?.name===n[t].name)&&(m=this.getAngleToSelected(s)*this.getRotationDirection(s),this.currentItem=h),this.itemParams[h.uuid]=e?n[t]:{...n[t]},this.itemList.push(h),this.wheel.add(h)}this.currentItem=this.currentItem||this.itemList[0],this.rotateMenu(m),this.addClickEvent(),e.add(this.wheel),s.addEventListener("wheel",(t=>{if(Math.abs(t.deltaY)<=20)return;let e=this.itemList.findIndex((t=>t.uuid===this.currentItem.uuid));e=t.deltaY>0?e-1<0?this.itemList.length-1:e-1:e+1>=this.itemList.length?0:e+1,this.rotateMenuToSelectedPosition(this.itemList[e])}))}rotateMenu(t){this.itemList.forEach((e=>{const{x:i,y:s}=e.position,n=Math.atan2(s,i)+t,o=this.radius*Math.cos(n),h=this.radius*Math.sin(n);e.position.x=o,e.position.y=h}))}rotateMenuToSelectedPosition(t){this.nextItem=t;const e=new this.THREE.Vector2(t.position.x,t.position.y);e.normalize(),this.rotationDirection=this.getRotationDirection(e),this.isRotating||this.currentItem.uuid===this.nextItem.uuid||(this.isRotating=!0)}getAngleToSelected(t){t.normalize();const e=a(this.selectedVector.x,this.selectedVector.y),i=a(t.x,t.y);let s=Math.abs(e-i);return s=s<.1&&s>.01?0:s,s}getTextSizeOnCanvas(t,e){const i=document.createElement("canvas").getContext("2d");i.font=e;const{width:s,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o}=i.measureText(t);return{width:s,height:n+o}}getRotationDirection(t){let e=1;if(!this.isBidirectional){const i=a(this.selectedVector.x,this.selectedVector.y),s=a(t.x,t.y),n=Math.abs(i-s),o=Math.abs(2*Math.PI-n);i>s?e=n>o?-1:1:s>i&&(e=n>o?1:-1)}return this.isReverse?-1*e:e}getTextSplite({text:t,width:e=0,height:i=0,color:s="#000",fillStyle:n="#fff",fontStyle:o="sans-serif",fontSize:h=30,padding:a=0}){const r=document.createElement("canvas"),c=r.getContext("2d"),{width:l,height:d}=this.getTextSizeOnCanvas(t,`${h*this.ITEM_RATIO}px ${o}`);r.width=(e||l)+2*a,r.height=(i||d)+2*a,c.font=`${h*this.ITEM_RATIO}px ${o}`,n&&(c.fillStyle=n,c.fillRect(0,0,e||r.width,r.height)),c.fillStyle=s;const u=(e||r.width)/2-l/2,f=(i||r.height)/2+d/2;c.fillText(t,u,f);const E=new this.THREE.Texture(r);E.needsUpdate=!0;const g=new this.THREE.SpriteMaterial({map:E,transparent:!1,sizeAttenuation:!0}),T=new this.THREE.Sprite(g);return T.scale.set(r.width/this.ITEM_RATIO,r.height/this.ITEM_RATIO,1),T}getCanvasSplite(t){const e=new this.THREE.Texture(t);e.needsUpdate=!0;const i=new this.THREE.SpriteMaterial({map:e,transparent:!1,sizeAttenuation:!0}),s=new this.THREE.Sprite(i);return s.scale.set(t.width/this.ITEM_RATIO,t.height/this.ITEM_RATIO,1),s}addClickEvent(){const t=new this.THREE.Vector2,e=new this.THREE.Raycaster;this.canvas.addEventListener("click",(i=>{const s=i.currentTarget,n=i.clientX-s.offsetLeft,o=i.clientY-s.offsetTop,h=s.offsetWidth,a=s.offsetHeight;t.x=n/h*2-1,t.y=-o/a*2+1,e.setFromCamera(t,this.camera);const r=e.intersectObjects(this.wheel.children);if(r&&r.length>0&&r[0]?.object){const t=r[0]?.object;this.onClick&&this.onClick(this.itemParams[t.uuid],t),this.rotateMenuToSelectedPosition(t)}}))}tick(){if(!1===this.isRotating)return;this.getAngleToSelected(new this.THREE.Vector2(this.nextItem.position.x,this.nextItem.position.y))>.1?this.rotateMenu(.1*this.rotationDirection):(this.isRotating=!1,this.currentItem=this.nextItem,this.onMoved&&this.onMoved(this.itemParams[this.nextItem.uuid],this.nextItem))}}var l=c;window.WheelMenu=c})),s("c565k");
//# sourceMappingURL=index.f003a5e5.js.map
